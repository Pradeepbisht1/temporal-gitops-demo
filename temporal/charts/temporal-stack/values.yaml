temporal:
  # Hard-disable non-SQL backends (you already set these via Argo, keep them here too)
  cassandra:
    enabled: false
  elasticsearch:
    enabled: false
  mysql:
    enabled: false

  server:
    # Your existing SQL persistence stays as-is; if your chart supports 'postgres12', prefer it:
    config:
      persistence:
        default:
          driver: sql
          sql:
            driver: postgres12   # change 'postgres' -> 'postgres12' if supported by your chart version
            dsn: ${SQL_DEFAULT_DSN}
            maxConns: 20
            maxConnLifetime: 1h
        visibility:
          driver: sql
          sql:
            driver: postgres12
            dsn: ${SQL_VISIBILITY_DSN}
            maxConns: 20
            maxConnLifetime: 1h

    # CRITICAL: make the binary read the Helm-generated config (not docker.yaml)
    additionalArgs:
      - "--env"
      - "kubernetes"
      - "--config"
      - "/etc/temporal/config/config.yaml"

    additionalEnv:
      - name: TEMPORAL_ENV
        value: "kubernetes"
      - name: TEMPORAL_CONFIG_DIR
        value: "/etc/temporal/config"
      - name: SQL_DEFAULT_DSN
        valueFrom:
          secretKeyRef:
            name: temporal-sql-secrets
            key: default.sql.dsn
      - name: SQL_VISIBILITY_DSN
        valueFrom:
          secretKeyRef:
            name: temporal-sql-secrets
            key: visibility.sql.dsn

  # Belt-and-suspenders: ensure EVERY service uses kubernetes env/paths
  frontend:
    additionalArgs: ["--env","kubernetes","--config","/etc/temporal/config/config.yaml"]
    additionalEnv:
      - name: TEMPORAL_ENV
        value: "kubernetes"
      - name: TEMPORAL_CONFIG_DIR
        value: "/etc/temporal/config"

  history:
    additionalArgs: ["--env","kubernetes","--config","/etc/temporal/config/config.yaml"]
    additionalEnv:
      - name: TEMPORAL_ENV
        value: "kubernetes"
      - name: TEMPORAL_CONFIG_DIR
        value: "/etc/temporal/config"

  matching:
    additionalArgs: ["--env","kubernetes","--config","/etc/temporal/config/config.yaml"]
    additionalEnv:
      - name: TEMPORAL_ENV
        value: "kubernetes"
      - name: TEMPORAL_CONFIG_DIR
        value: "/etc/temporal/config"

  worker:
    additionalArgs: ["--env","kubernetes","--config","/etc/temporal/config/config.yaml"]
    additionalEnv:
      - name: TEMPORAL_ENV
        value: "kubernetes"
      - name: TEMPORAL_CONFIG_DIR
        value: "/etc/temporal/config"
        
prometheus:
  nodeExporter:
    enabled: false

