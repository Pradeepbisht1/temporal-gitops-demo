temporal:
  server:
    image:
      tag: "1.28.1"
    extraArgs:
      - "--allow-no-auth"
    config:
      persistence:
        defaultStore: sql
        numHistoryShards: 4
      # namespaces must be a map with {create, namespace: []}
      namespaces:
        create: true
        namespace:
          - name: default
            retention: 7d

    sql:
      driver: postgres
      user: "${POSTGRES_USER}"
      password: "${POSTGRES_PWD}"
      host: "temporal-pg-rw.postgres-temporal.svc.cluster.local"
      port: 5432
      database: "temporal"
      ssl:
        enabled: false
      visibility:
        user: "${POSTGRES_USER}"
        password: "${POSTGRES_PWD}"
        host: "temporal-pg-rw.postgres-temporal.svc.cluster.local"
        port: 5432
        database: "temporal_visibility"
        ssl:
          enabled: false

    additionalEnv:
      - name: SQL_MAX_IDLE_CONNS
        value: "50"
      - name: SQL_MAX_OPEN_CONNS
        value: "200"
      - name: SQL_CONN_MAX_LIFETIME
        value: "1h"

  # first sync only â€” run DB migrations
  schema:
    createDatabase:
      enabled: true
    setup:
      enabled: true
    update:
      enabled: true

  envFrom:
    - secretRef:
        name: temporal-sql-secrets

  history:
    replicaCount: 1
  matching:
    replicaCount: 1
  frontend:
    replicaCount: 1
  worker:
    replicaCount: 1

# --- Not needed with Postgres: turn off these extras ---
cassandra:
  enabled: false

elasticsearch:
  enabled: false

# --- Turn off monitoring stack to avoid PVC & extra pods ---
prometheus:
  enabled: false
grafana:
  enabled: false
alertmanager:
  enabled: false
pushgateway:
  enabled: false
kubeStateMetrics:
  enabled: false
nodeExporter:
  enabled: false
