temporal:
  # hard-disable non-SQL backends
  cassandra:
    enabled: false
  elasticsearch:
    enabled: false
  mysql:
    enabled: false

  server:
    # SQL persistence using env DSNs from secret (already created)
    config:
      persistence:
        default:
          driver: sql
          sql:
            driver: postgres12        # use postgres12 driver
            dsn: ${SQL_DEFAULT_DSN}
            maxConns: 20
            maxConnLifetime: 1h
        visibility:
          driver: sql
          sql:
            driver: postgres12
            dsn: ${SQL_VISIBILITY_DSN}
            maxConns: 20
            maxConnLifetime: 1h

    # ðŸš¨ ALWAYS start with k8s env + the mounted file path
    command: ["temporal-server"]
    args:
      - start
      - --env
      - kubernetes
      - --config
      - /etc/temporal/config/config_template.yaml

    additionalEnv:
      - name: TEMPORAL_ENV
        value: kubernetes
      - name: TEMPORAL_CONFIG_DIR
        value: /etc/temporal/config
      - name: SQL_DEFAULT_DSN
        valueFrom:
          secretKeyRef:
            name: temporal-sql-secrets
            key: default.sql.dsn
      - name: SQL_VISIBILITY_DSN
        valueFrom:
          secretKeyRef:
            name: temporal-sql-secrets
            key: visibility.sql.dsn

  # Also pin each service (some chart variants run them as separate Deployments)
  frontend:
    command: ["temporal-server"]
    args: ["start","--env","kubernetes","--config","/etc/temporal/config/config_template.yaml"]
    additionalEnv:
      - name: TEMPORAL_ENV
        value: kubernetes
      - name: TEMPORAL_CONFIG_DIR
        value: /etc/temporal/config

  history:
    command: ["temporal-server"]
    args: ["start","--env","kubernetes","--config","/etc/temporal/config/config_template.yaml"]
    additionalEnv:
      - name: TEMPORAL_ENV
        value: kubernetes
      - name: TEMPORAL_CONFIG_DIR
        value: /etc/temporal/config

  matching:
    command: ["temporal-server"]
    args: ["start","--env","kubernetes","--config","/etc/temporal/config/config_template.yaml"]
    additionalEnv:
      - name: TEMPORAL_ENV
        value: kubernetes
      - name: TEMPORAL_CONFIG_DIR
        value: /etc/temporal/config

  worker:
    command: ["temporal-server"]
    args: ["start","--env","kubernetes","--config","/etc/temporal/config/config_template.yaml"]
    additionalEnv:
      - name: TEMPORAL_ENV
        value: kubernetes
      - name: TEMPORAL_CONFIG_DIR
        value: /etc/temporal/config

prometheus:
  nodeExporter:
    enabled: false
